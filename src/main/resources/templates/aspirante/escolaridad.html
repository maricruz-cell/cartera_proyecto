<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Escolaridad</title>

    <link rel="stylesheet" th:href="@{/css/aspirante-menu.css}">
    <link rel="stylesheet" th:href="@{/css/escolaridad.css}">
</head>

<body>

<div class="layout">

    <!-- ▬▬▬ TOPBAR ▬▬▬ -->
    <header class="topbar">
        <div class="topbar-left">
            <span class="brand">EMPLEO</span>

            <button id="toggleSidebar" class="menu-toggle">
                <span></span><span></span><span></span>
            </button>
        </div>

        <div class="topbar-right">
            <img class="avatar" th:src="@{${fotoAspirante}}">
            <span class="user-name" th:text="${nombreAspirante}">Aspirante</span>
        </div>
    </header>

    <div class="body">

        <!-- ▬▬▬ SIDEBAR ▬▬▬ -->
        <aside id="sidebar" class="sidebar">
            <ul>
                <li><a th:href="@{/aspirante/datos-personales}">
                    <img src="/img/icon-datos.png">
                    <span>Datos Personales</span>
                </a></li>

                <li class="active"><a th:href="@{/aspirante/escolaridad}">
                    <img src="/img/icon-escolaridad.png">
                    <span>Escolaridad</span>
                </a></li>

                <li><a th:href="@{/aspirante/experiencia-laboral}">
                    <img src="/img/icon-experiencia.png">
                    <span>Experiencia Laboral</span>
                </a></li>

                <li><a th:href="@{/aspirante/capacitacion}">
                    <img src="/img/icon-capacitacion1.png">
                    <span>Capacitación</span>
                </a></li>

                <li><a th:href="@{/aspirante/conocimientos}">
                    <img src="/img/icon-conocimiento.png">
                    <span>Conocimientos Específicos</span>
                </a></li>

                <li><a th:href="@{/aspirante/competencias}">
                    <img src="/img/icon-competencias.png">
                    <span>Competencias y Habilidades</span>
                </a></li>

                <li><a th:href="@{/aspirante/cambiar-contrasena}">
                    <img src="/img/icon-password.png">
                    <span>Cambiar Contraseña</span>
                </a></li>

                <li><a th:href="@{/aspirante/eliminar-cuenta}">
                    <img src="/img/icon-eliminar.png">
                    <span>Eliminar Usuario</span>
                </a></li>
            </ul>

            <div class="logout-section">
                <a th:href="@{/logout}" class="logout-btn">CERRAR SESIÓN</a>
            </div>
        </aside>

        <!-- ▬▬▬ CONTENIDO PRINCIPAL ▬▬▬ -->
        <main id="content" class="content">

            <h2 class="titulo-seccion">INFORMACIÓN ACADÉMICA</h2>
            <p class="sub-text">Consulta y actualiza tu información académica.</p>

            <button class="btn-add" onclick="mostrarFormulario()">+ Agregar nuevo</button>

            <!-- ▬▬▬ LISTA DE ESCOLARIDAD ▬▬▬ -->
            <table class="tabla-registros">
                <thead>
                <tr>
                    <th>Último Grado</th>
                    <th>Documento Obtenido</th>
                    <th>Institución</th>
                    <th>Modalidad</th>
                    <th>Carrera</th>
                    <th>Carrera Específica</th>
                    <th>Año Inicio</th>
                    <th>Año Fin</th>
                    <th>Años Cursados</th>
                    <th>Acciones</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="x : ${listaEscolaridad}">
                    <td th:text="${x.estudioNombre}"></td>
                    <td th:text="${x.gradoNombre}"></td>
                    <td th:text="${x.institucionNombre}"></td>
                    <td th:text="${x.modalidadNombre}"></td>
                    <td th:text="${x.licenciaturaNombre}"></td>
                    <td th:text="${x.otraCarrera}"></td>
                    <td th:text="${x.anioInicio}"></td>
                    <td th:text="${x.anioFin}"></td>
                    <td th:text="${x.aniosCursados}"></td>

                    <td>
                        <a th:href="@{'/aspirante/escolaridad/editar/' + ${x.idEscolaridad}}"
                           class="btn-edit">Editar</a>

                        <a th:href="@{'/aspirante/escolaridad/eliminar/' + ${x.idEscolaridad}}"
                           onclick="return confirm('¿Eliminar registro?')"
                           class="btn-delete">Eliminar</a>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- ▬▬▬ FORMULARIO ▬▬▬ -->

                <div id="form-escolaridad"
                     class="form-box"
                     th:classappend="${mostrarForm} ? '' : ' hidden'">


                <h2 class="titulo-seccion">DATOS ESCOLARES</h2>

                <form th:action="@{/aspirante/escolaridad/guardar}"
                      th:object="${escolaridadForm}"
                      method="post">

                    <input type="hidden" th:field="*{idEscolaridad}">
                    <input type="hidden" th:field="*{idPersona}">

                    <div class="row">
                        <div class="col">
                            <label>Último grado de estudios:</label>
                            <select th:field="*{idEstudio}">
                                <option value="">SELECCIONAR</option>
                                <option th:each="e : ${estudios}"
                                        th:value="${e.idEstudio}"
                                        th:text="${e.descEstudio}">
                                </option>
                            </select>
                        </div>

                        <div class="col">
                            <label>Documento obtenido:</label>
                            <select th:field="*{idGrado}">
                                <option value="">SELECCIONAR</option>
                                <option th:each="g : ${grados}"
                                        th:value="${g.idGrado}"
                                        th:text="${g.desGrado}">
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>Carrera profesional o afín:</label>
                            <select th:field="*{idLicenciatura}">
                                <option value="">SELECCIONAR</option>
                                <option th:each="l : ${licenciaturas}"
                                        th:value="${l.idLicenciatura}"
                                        th:text="${l.desLicenciatura}">
                                </option>
                            </select>
                        </div>

                        <div class="col">
                            <label>Carrera específica:</label>
                            <input type="text" th:field="*{otraCarrera}">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>Institución:</label>
                            <select th:field="*{idInstitucion}">
                                <option value="">SELECCIONAR</option>
                                <option th:each="i : ${instituciones}"
                                        th:value="${i.idInstitucion}"
                                        th:text="${i.desInstitucion}">
                                </option>
                            </select>
                        </div>

                        <div class="col">
                            <label>Modalidad:</label>
                            <select th:field="*{idModalidad}">
                                <option value="">SELECCIONAR</option>
                                <option th:each="m : ${modalidades}"
                                        th:value="${m.idModalidad}"
                                        th:text="${m.desModalidad}">
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <label>Año inicio:</label>
                            <input type="number" th:field="*{anioInicio}">
                        </div>

                        <div class="col">
                            <label>Año fin:</label>
                            <input type="number" th:field="*{anioFin}">
                        </div>

                        <div class="col">
                            <label>Años cursados:</label>
                            <input type="number" th:field="*{aniosCursados}" readonly>
                        </div>
                    </div>

                    <div class="acciones">
                        <button type="button" class="btn-cancelar" onclick="cancelar()">CANCELAR</button>
                        <button type="submit" class="btn-guardar">GUARDAR</button>
                    </div>
                </form>

            </div>

        </main>
    </div>
</div>

<script th:src="@{/js/aspirante-menu.js}"></script>

<script>
    function mostrarFormulario() {
        document.getElementById("form-escolaridad").classList.remove("hidden");
    }

    function cancelar() {
        document.getElementById("form-escolaridad").classList.add("hidden");
    }
</script>

<script>
    const anioInicioInput = document.querySelector('input[name="anioInicio"]');
    const anioFinInput = document.querySelector('input[name="anioFin"]');
    const aniosCursadosInput = document.querySelector('input[name="aniosCursados"]');

    function calcularAnios() {
        const inicio = parseInt(anioInicioInput.value);
        const fin = parseInt(anioFinInput.value);
        const yearNow = new Date().getFullYear();

        if ((inicio && (inicio < 1900 || inicio > yearNow)) ||
            (fin && (fin < 1900 || fin > yearNow))) {
            alert("⚠ El año debe estar entre 1900 y " + yearNow);
            aniosCursadosInput.value = "";
            return;
        }

        if (!isNaN(inicio) && !isNaN(fin) && fin < inicio) {
            alert("⚠ El año de fin no puede ser menor al año de inicio.");
            aniosCursadosInput.value = "";
            return;
        }

        if (!isNaN(inicio) && !isNaN(fin)) {
            aniosCursadosInput.value = fin - inicio;
        } else {
            aniosCursadosInput.value = "";
        }
    }

    anioInicioInput.addEventListener("input", calcularAnios);
    anioFinInput.addEventListener("input", calcularAnios);
</script>

</body>
</html>
