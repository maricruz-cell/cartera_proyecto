<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Datos Personales</title>
    <link rel="stylesheet" th:href="@{/css/aspirante-menu.css}">
    <link rel="stylesheet" th:href="@{/css/datos-personales.css}">
</head>

<body>

<div class="layout">

    <!-- ▬▬▬▬▬▬▬ TOPBAR ▬▬▬▬▬▬▬ -->
    <header class="topbar">
        <div class="topbar-left">
            <span class="brand">EMPLEO</span>

            <button id="toggleSidebar" class="menu-toggle">
                <span></span><span></span><span></span>
            </button>
        </div>

        <div class="topbar-right">
            <img class="avatar" th:src="@{${fotoAspirante}}">
            <span class="user-name" th:text="${nombreAspirante}">Aspirante</span>
        </div>
    </header>

    <div class="body">

        <!-- ▬▬▬▬▬▬▬ SIDEBAR ▬▬▬▬▬▬▬ -->
        <aside id="sidebar" class="sidebar">
            <ul>
                <li class="active">
                    <a th:href="@{/aspirante/datos-personales}">
                        <img src="/img/icon-datos.png">
                        <span>Datos Personales</span>
                    </a>
                </li>

                <li><a th:href="@{/aspirante/escolaridad}">
                    <img src="/img/icon-escolaridad.png">
                    <span>Escolaridad</span>
                </a></li>

                <li><a th:href="@{/aspirante/experiencia-laboral}">
                    <img src="/img/icon-experiencia.png">
                    <span>Experiencia Laboral</span>
                </a></li>

                <li><a th:href="@{/aspirante/capacitacion}">
                    <img src="/img/icon-capacitacion1.png">
                    <span>Capacitación</span>
                </a></li>

                <li><a th:href="@{/aspirante/conocimientos}">
                    <img src="/img/icon-conocimiento.png">
                    <span>Conocimientos Específicos</span>
                </a></li>

                <li><a th:href="@{/aspirante/competencias}">
                    <img src="/img/icon-competencias.png">
                    <span>Competencias y Habilidades</span>
                </a></li>

                <li><a th:href="@{/aspirante/cargardocumentos}">
                    <img src="/img/icon-competencias.png">
                    <span>Cargar Documentos</span>
                </a></li>

                <li><a th:href="@{/aspirante/cambiar-contrasena}">
                    <img src="/img/icon-password.png">
                    <span>Cambiar Contraseña</span>
                </a></li>

                <li><a th:href="@{/aspirante/eliminar-cuenta}">
                    <img src="/img/icon-eliminar.png">
                    <span>Eliminar Usuario</span>
                </a></li>
            </ul>

            <div class="logout-section">
                <a th:href="@{/logout}" class="logout-btn">CERRAR SESIÓN</a>
            </div>
        </aside>

        <!-- ▬▬▬▬▬▬▬ CONTENIDO PRINCIPAL ▬▬▬▬▬▬▬ -->
        <main id="content" class="content">

            <!-- TÍTULO -->
            <h2 class="titulo-seccion">DATOS PERSONALES</h2>

            <!-- ================= FORMULARIO ================= -->
            <div class="form-container">
                <form th:object="${persona}" method="post" th:action="@{/aspirante/datos-personales/guardar}">
                    <input type="hidden" th:field="*{idPersona}">

                    <!-- ===== PRIMERA TARJETA ===== -->
                    <section class="card">
                        <div class="row">
                            <div class="col">
                                <label>Nombre(s):</label>
                                <input type="text" th:field="*{nombre}" readonly>
                            </div>

                            <div class="col">
                                <label>Apellido Paterno:</label>
                                <input type="text" th:field="*{apellidoPaterno}" readonly>
                            </div>

                            <div class="col">
                                <label>Apellido Materno:</label>
                                <input type="text" th:field="*{apellidoMaterno}" readonly>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label>CURP:</label>
                                <input type="text" th:field="*{curp}" readonly>
                            </div>

                            <div class="col">
                                <label>RFC:</label>
                                <input type="text" th:field="*{rfc}" readonly>
                            </div>

                            <div class="col">
                                <label>Nacionalidad:</label>

                                <select class="form-select" disabled>
                                    <option th:each="n : ${nacionalidades}"
                                            th:value="${n.id_nacionalidad}"
                                            th:text="${n.descripcion}"
                                            th:selected="${n.id_nacionalidad} == ${persona.nacionalidad}">
                                    </option>
                                </select>

                                <input type="hidden" th:field="*{nacionalidad}">
                            </div>

                        </div>

                        <div class="row">
                            <div class="col">
                                <label>Fecha de Nacimiento:</label>
                                <span th:text="${persona.fechaNacimiento}"></span>
                                <input type="hidden" th:value="${persona.fechaNacimiento}" th:field="*{fechaNacimiento}">
                            </div>

                            <div class="col">
                                <label>Edad:</label>
                                <input type="number" th:field="*{edad}">
                            </div>

                            <div class="col">
                                <label>Género:</label>
                                <select th:field="*{sexo}">
                                    <option value="">SELECCIONAR</option>
                                    <option value="H">HOMBRE</option>
                                    <option value="M">MUJER</option>
                                </select>
                            </div>

                            <div class="col">
                                <label>Estado Civil:</label>
                                <select th:field="*{estadoCivil}">
                                    <option value="">SELECCIONAR</option>
                                    <option value="1">SOLTERO(A)</option>
                                    <option value="2">CASADO(A)</option>
                                    <option value="3">DIVORCIADO(A)</option>
                                    <option value="4">VIUDO(A)</option>
                                </select>
                            </div>
                        </div>
                    </section>


                    <!-- ===================== DIRECCIÓN ===================== -->
                    <h2 class="titulo-seccion">DIRECCIÓN</h2>

                    <section class="card">

                        <!-- ESTADO -->
                        <div class="col">
                            <label>Estado:</label>
                            <select id="estado" class="form-select" th:field="*{idEstado}">
                                <option value="">SELECCIONAR ESTADO</option>
                                <option th:each="e : ${estados}"
                                        th:value="${e.idEstado}"
                                        th:text="${e.nomEstado}">
                                </option>
                            </select>
                        </div>

                        <!-- MUNICIPIO -->
                        <div class="col">
                            <label>Municipio:</label>
                            <select id="municipio" class="form-select" th:field="*{idMunicipio}">
                                <option value="">SELECCIONAR MUNICIPIO</option>
                            </select>
                        </div>

                        <!-- LOCALIDAD -->
                        <div class="col">
                            <label>Localidad:</label>
                            <select id="localidad" class="form-select" th:field="*{idLocalidad}">
                                <option value="">SELECCIONAR LOCALIDAD</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label>Colonia:</label>
                                <input type="text" th:field="*{colonia}">
                            </div>

                            <div class="col">
                                <label>Calle:</label>
                                <input type="text" th:field="*{calle}">
                            </div>

                            <div class="col">
                                <label>Código Postal:</label>
                                <input type="text" th:field="*{codigoPostal}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label>Número Exterior:</label>
                                <input type="text" th:field="*{numExterior}">
                            </div>

                            <div class="col">
                                <label>Número Interior:</label>
                                <input type="text" th:field="*{numInterior}">
                            </div>
                        </div>
                    </section>


                    <!-- ===================== CONTACTO ===================== -->
                    <h2 class="titulo-seccion">CONTACTO</h2>

                    <section class="card">
                        <p class="nota">
                            Importante: El número y correo de recados debe ser diferente al número personal.
                        </p>

                        <div class="row">
                            <div class="col">
                                <label>Número Personal (Celular):</label>
                                <input type="text" th:field="*{telefono}">
                            </div>

                            <div class="col">
                                <label>Número de recados:</label>
                                <input type="text" th:field="*{telefonoRecados}">
                            </div>

                            <div class="col">
                                <label>Correo Electrónico:</label>
                                <input type="email" th:field="*{correoAlternativo}">
                            </div>

                            <div class="col">
                                <label>Red Social:</label>
                                <input type="text" th:field="*{redSocial}">
                            </div>
                        </div>
                    </section>


                    <!-- ===================== DATOS ADICIONALES ===================== -->
                    <h2 class="titulo-seccion">DATOS ADICIONALES</h2>

                    <section class="card">

                        <div class="row">
                            <div class="col">
                                <label>¿Es usted servidor público?</label>
                                <select th:field="*{esEmpleado}">
                                    <option value="">SELECCIONAR</option>
                                    <option value="true">SÍ</option>
                                    <option value="false">NO</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label>Sueldo deseado:</label>
                                <input type="text" th:field="*{sueldo}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <label>Disponibilidad de Horario:</label>
                                <select th:field="*{disponibilidadHorario}">
                                    <option value="">SELECCIONAR</option>
                                    <option value="1">MAÑANA</option>
                                    <option value="2">TARDE</option>
                                    <option value="3">NOCHE</option>
                                </select>
                            </div>

                            <div class="col">
                                <label>Disponibilidad para viajar:</label>
                                <select th:field="*{disponibilidadViajar}">
                                    <option value="">SELECCIONAR</option>
                                    <option value="1">SÍ</option>
                                    <option value="2">NO</option>
                                </select>
                            </div>
                        </div>

                    </section>

                    <div class="acciones">
                        <button type="button" class="btn-cancelar">CANCELAR</button>
                        <button type="submit" class="btn-guardar">GUARDAR</button>
                    </div>

                </form>
            </div>

        </main>
    </div>

</div>

<script th:src="@{/js/aspirante-menu.js}"></script>

<!-- ========================= JS DEPENDIENTE OPTIMIZADO ========================== -->
<script>
    document.addEventListener("DOMContentLoaded", function () {

        let estadoSelect = document.getElementById("estado");
        let municipioSelect = document.getElementById("municipio");
        let localidadSelect = document.getElementById("localidad");

        let estadoActual = estadoSelect.value;
        let municipioActual = municipioSelect.value;
        let localidadActual = localidadSelect.value;

        // === PRECARGA ===
        if (estadoActual) {
            fetch(`/api/municipios/${estadoActual}`)
                .then(r => r.json())
                .then(municipios => {

                    municipioSelect.innerHTML = '<option value="">SELECCIONAR MUNICIPIO</option>';

                    municipios.forEach(m => {
                        municipioSelect.innerHTML += `<option value="${m.idMunicipio}">${m.nomMunicipio}</option>`;
                    });

                    municipioSelect.value = municipioActual;

                    if (municipioActual) {
                        fetch(`/api/localidades/${municipioActual}`)
                            .then(r => r.json())
                            .then(localidades => {

                                localidadSelect.innerHTML = '<option value="">SELECCIONAR LOCALIDAD</option>';

                                localidades.forEach(l => {
                                    localidadSelect.innerHTML += `<option value="${l.idLocalidad}">${l.nomLocalidad}</option>`;
                                });

                                localidadSelect.value = localidadActual;
                            });
                    }
                });
        }

        // === Cambio de ESTADO ===
        estadoSelect.addEventListener("change", function () {

            let idEstado = this.value;

            municipioSelect.innerHTML = '<option value="">SELECCIONAR MUNICIPIO</option>';
            localidadSelect.innerHTML = '<option value="">SELECCIONAR LOCALIDAD</option>';

            if (!idEstado) return;

            fetch(`/api/municipios/${idEstado}`)
                .then(r => r.json())
                .then(municipios => {
                    municipios.forEach(m => {
                        municipioSelect.innerHTML += `<option value="${m.idMunicipio}">${m.nomMunicipio}</option>`;
                    });
                });
        });

        // === Cambio de MUNICIPIO ===
        municipioSelect.addEventListener("change", function () {

            let idMunicipio = this.value;

            localidadSelect.innerHTML = '<option value="">SELECCIONAR LOCALIDAD</option>';

            if (!idMunicipio) return;

            fetch(`/api/localidades/${idMunicipio}`)
                .then(r => r.json())
                .then(localidades => {
                    localidades.forEach(l => {
                        localidadSelect.innerHTML += `<option value="${l.idLocalidad}">${l.nomLocalidad}</option>`;
                    });
                });
        });

    });
</script>

</body>
</html>
