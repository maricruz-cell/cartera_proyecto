<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cambiar contraseña</title>

    <!-- Layout aspirante -->
    <link rel="stylesheet" th:href="@{/css/aspirante-menu.css}">
    <!-- Estilos propios -->
    <link rel="stylesheet" th:href="@{/css/cambiar-contrasena.css}">
</head>
<body>

<div class="layout">

    <!-- ▬▬▬ TOPBAR ▬▬▬ -->
    <header class="topbar">
        <div class="topbar-left">
            <span class="brand">EMPLEO</span>

            <button id="toggleSidebar" class="menu-toggle">
                <span></span><span></span><span></span>
            </button>
        </div>

        <div class="topbar-right">
            <img class="avatar" th:src="@{${fotoAspirante}}">
            <span class="user-name" th:text="${nombreAspirante}">Aspirante</span>
        </div>
    </header>

    <div class="body">

        <!-- ▬▬▬ SIDEBAR ▬▬▬ -->
        <aside id="sidebar" class="sidebar">
            <ul>
                <li><a th:href="@{/aspirante/datos-personales}">
                    <img src="/img/icon-datos.png">
                    <span>Datos Personales</span>
                </a></li>

                <li><a th:href="@{/aspirante/escolaridad}">
                    <img src="/img/icon-escolaridad.png">
                    <span>Escolaridad</span>
                </a></li>

                <li><a th:href="@{/aspirante/experiencia-laboral}">
                    <img src="/img/icon-experiencia.png">
                    <span>Experiencia Laboral</span>
                </a></li>

                <li><a th:href="@{/aspirante/capacitacion}">
                    <img src="/img/icon-capacitacion1.png">
                    <span>Capacitación</span>
                </a></li>

                <li><a th:href="@{/aspirante/conocimientos}">
                    <img src="/img/icon-conocimiento.png">
                    <span>Conocimientos Específicos</span>
                </a></li>

                <li><a th:href="@{/aspirante/competencias}">
                    <img src="/img/icon-competencias.png">
                    <span>Competencias y Habilidades</span>
                </a></li>
                <li><a th:href="@{/aspirante/cargardocumentos}">
                    <img src="/img/icon-competencias.png">
                    <span>Cargar Documentos</span>
                </a></li>

                <li class="active"><a th:href="@{/aspirante/cambiar-contrasena}">
                    <img src="/img/icon-password.png">
                    <span>Cambiar Contraseña</span>
                </a></li>

                <li><a th:href="@{/aspirante/eliminar-cuenta}">
                    <img src="/img/icon-eliminar.png">
                    <span>Eliminar Usuario</span>
                </a></li>
            </ul>

            <div class="logout-section">
                <a th:href="@{/logout}" class="logout-btn">CERRAR SESIÓN</a>
            </div>
        </aside>

        <!-- ▬▬▬ CONTENIDO PRINCIPAL ▬▬▬ -->
        <main id="content" class="content">

            <!-- ║ MODAL IMPORTANTE ║ -->
            <div id="modalImportante" class="modal-overlay">
                <div class="modal-card">
                    <div class="modal-icon">!</div>
                    <h2 class="modal-title">IMPORTANTE</h2>

                    <p class="modal-text">
                        Tu contraseña debe cumplir con los requisitos de seguridad.
                        Para crear una contraseña segura, asegúrate de incluir:
                    </p>

                    <ul class="modal-list">
                        <li>Al menos 8 caracteres.</li>
                        <li>Letras mayúsculas (A–Z).</li>
                        <li>Letras minúsculas (a–z).</li>
                        <li>Números (0–9).</li>
                        <li>Símbolos del teclado (por ejemplo: # $ % &amp; ! ?).</li>
                    </ul>

                    <button id="btnCerrarModal" class="btn-modal-ok">OK</button>
                </div>
            </div>

            <!-- ║ TARJETA CAMBIAR CONTRASEÑA ║ -->
            <div class="card-password">
                <h2 class="titulo-seccion">CAMBIAR CONTRASEÑA</h2>

                <p class="sub-text">
                    Cambia tu contraseña en un entorno seguro. Asegúrate de crear una
                    combinación fuerte y confidencial.
                </p>

                <form th:action="@{/aspirante/cambiar-contrasena}"
                      method="post"
                      onsubmit="return validarAntesDeEnviar();">

                    <!-- Contraseña actual -->
                    <div class="form-row">
                        <label>CONTRASEÑA ACTUAL:</label>
                        <input type="password"
                               id="actual"
                               name="actual"
                               placeholder="Escribe tu contraseña actual"
                               required>
                    </div>

                    <!-- Nueva contraseña -->
                    <div class="form-row">
                        <label>NUEVA CONTRASEÑA:</label>
                        <input type="password"
                               id="nueva"
                               name="nueva"
                               placeholder="Escribe tu nueva contraseña"
                               required>
                    </div>

                    <!-- Confirmación -->
                    <div class="form-row">
                        <label>CONFIRMAR CONTRASEÑA:</label>
                        <input type="password"
                               id="confirmar"
                               name="confirmar"
                               placeholder="Vuelve a escribir tu contraseña"
                               required>
                    </div>

                    <p id="mensajeValidacion" class="mensaje-validacion">
                        Evita usar datos personales o combinaciones predecibles.
                    </p>

                    <div class="acciones-extra">
                        <button type="button" class="btn-secundario" onclick="validarContrasena();">
                            Validar Contraseña
                        </button>

                        <button type="button" class="btn-secundario" onclick="validarContrasena(true);">
                            Actualizar Contraseña
                        </button>
                    </div>

                    <div class="acciones-finales">
                        <button type="button" class="btn-cancelar"
                                onclick="window.location.href='/aspirante/datos-personales'">
                            CANCELAR
                        </button>

                        <button type="submit" class="btn-guardar">
                            GUARDAR
                        </button>
                    </div>

                </form>
            </div>

            <div class="footer-aspirante">
                SUBDIRECCIÓN DE RECLUTAMIENTO Y SELECCIÓN DEL PERSONAL
            </div>

        </main>
    </div>

</div>

<script th:src="@{/js/aspirante-menu.js}"></script>

<script>
    // ----- MODAL -----
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("btnCerrarModal").addEventListener("click", () => {
            document.getElementById("modalImportante").classList.add("hidden");
        });
    });

    // ----- VALIDACIONES -----
    function cumpleRequisitos(password) {
        return {
            ok:
                password.length >= 8 &&
                /[A-Z]/.test(password) &&
                /[a-z]/.test(password) &&
                /[0-9]/.test(password) &&
                /[^A-Za-z0-9]/.test(password)
        };
    }

    function validarContrasena(desdeActualizar) {
        const actual = document.getElementById("actual").value;
        const nueva = document.getElementById("nueva").value;
        const confirmar = document.getElementById("confirmar").value;

        const msg = document.getElementById("mensajeValidacion");

        if (!actual) {
            msg.textContent = "Debes escribir tu contraseña actual.";
            msg.classList.add("error");
            return false;
        }

        if (nueva !== confirmar) {
            msg.textContent = "Las contraseñas no coinciden.";
            msg.classList.add("error");
            return false;
        }

        if (!cumpleRequisitos(nueva).ok) {
            msg.textContent = "La contraseña no cumple con los requisitos de seguridad.";
            msg.classList.add("error");
            return false;
        }

        msg.textContent = "La contraseña es válida.";
        msg.classList.remove("error");
        msg.classList.add("ok");

        if (desdeActualizar === true) {
            document.querySelector("form").submit();
        }

        return true;
    }

    function validarAntesDeEnviar() {
        return validarContrasena(false);
    }
</script>

</body>
</html>
